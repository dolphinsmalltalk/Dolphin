"Filed out from Dolphin Smalltalk"!

OS.COM.IUnknown
	subclass: #'OS.COM.IPicture'
	instanceVariableNames: ''
	classVariableNames: ''
	imports: #()
	classInstanceVariableNames: ''
	classConstants: {
			'PICTYPE_BITMAP' -> 16r1.
			'PICTYPE_ENHMETAFILE' -> 16r4.
			'PICTYPE_ICON' -> 16r3.
			'PICTYPE_METAFILE' -> 16r2.
			'PICTYPE_NONE' -> 16r0.
			'PICTYPE_UNINITIALIZED' -> -16r1
		}!
OS.COM.IPicture guid: (OS.COM.IID fromString: '{7bf80980-bf32-101a-8bbb-00aa00300cab}')!
OS.COM.IPicture comment: '`IPicture` is a wrapper class for the COM interface ''stdole.IPicture'' generated from type information in the ''OLE Automation'' library. It contains methods to invoke the member functions exposed by that interface.

The type library contains the following helpstring for this interface
	"Picture Object"

This class was originally auto-generated by the Active-X Component Wizard, but is has been modified to support compatibility between OLE Pictures and other Image types in Dolphin.

IDL definition follows:
```
[
	object, 
	uuid(7bf80980-bf32-101a-8bbb-00aa00300cab), 
	helpstring("Picture Object"), 
	hidden
]
interface IPicture : IUnknown
 {
	[id(0x60010000), propget]
	HRESULT __stdcall Handle(
		[out, retval]OLE_HANDLE* phandle);
	[id(0x60010001), propget]
	HRESULT __stdcall hPal(
		[out, retval]OLE_HANDLE* phpal);
	[id(0x60010002), propget]
	HRESULT __stdcall Type(
		[out, retval]short* ptype);
	[id(0x60010003), propget]
	HRESULT __stdcall Width(
		[out, retval]OLE_XSIZE_HIMETRIC* pwidth);
	[id(0x60010004), propget]
	HRESULT __stdcall Height(
		[out, retval]OLE_YSIZE_HIMETRIC* pheight);
	[id(0x60010005)]
	HRESULT __stdcall Render(
		[in]int hdc,
		[in]long x,
		[in]long y,
		[in]long cx,
		[in]long cy,
		[in]OLE_XPOS_HIMETRIC xSrc,
		[in]OLE_YPOS_HIMETRIC ySrc,
		[in]OLE_XSIZE_HIMETRIC cxSrc,
		[in]OLE_YSIZE_HIMETRIC cySrc,
		[in]void* prcWBounds);
	[id(0x60010001), propput]
	HRESULT __stdcall hPal(
		[in]OLE_HANDLE phpal);
	[id(0x60010007), propget]
	HRESULT __stdcall CurDC(
		[out, retval]int* phdcOut);
	[id(0x60010008)]
	HRESULT __stdcall SelectPicture(
		[in]int hdcIn,
		[out]int* phdcOut,
		[out]OLE_HANDLE* phbmpOut);
	[id(0x60010009), propget]
	HRESULT __stdcall KeepOriginalFormat(
		[out, retval]VARIANT_BOOL* pfkeep);
	[id(0x60010009), propput]
	HRESULT __stdcall KeepOriginalFormat(
		[in]VARIANT_BOOL pfkeep);
	[id(0x6001000b)]
	HRESULT __stdcall PictureChanged();
	[id(0x6001000c)]
	HRESULT __stdcall SaveAsFile(
		[in]void* pstm,
		[in]VARIANT_BOOL fSaveMemCopy,
		[out]long* pcbSize);
	[id(0x6001000d), propget]
	HRESULT __stdcall Attributes(
		[out, retval]long* pdwAttr);
	[id(0x6001000e)]
	HRESULT __stdcall SetHdc(
		[in]OLE_HANDLE hdc);
};
```
'!
!OS.COM.IPicture categoriesForClass!COM-Interfaces! !
!OS.COM.IPicture methodsFor!

attributes
	"Answer the <sdword> value of the 'Attributes' property of the receiver."

	| answer |
	answer := Int32 new.
	self get_Attributes: answer.
	^answer asObject!

curDC
	"Answer the <sdword> value of the 'CurDC' property of the receiver."

	| answer |
	answer := Handle new.
	self get_CurDC: answer.
	^answer asObject!

extent
	"Answer the hi-metric extent of the receiver."

	| buf x |
	buf := Int32 new.
	self get_Width: buf.
	x := buf asInteger.
	self get_Height: buf.
	^x @ buf asInteger!

get_Attributes: pdwAttr
	"Private - Get the value of the 'Attributes' property of the receiver.

		HRESULT __stdcall Attributes(
			[out, retval]long* pdwAttr);"

	<virtual stdcall: hresult 17 int32*>
	^self invalidCall: _failureCode!

get_CurDC: phdcOut
	"Private - Get the value of the 'CurDC' property of the receiver.

		HRESULT __stdcall CurDC(
			[out, retval] HDC* phdcOut);"

	"Implementation Note: Autogenerated method modified to use handle argument type"

	<virtual stdcall: hresult 11 handle*>
	^self invalidCall: _failureCode!

get_Handle: phandle
	"Private - Get the value of the 'Handle' property of the receiver.

		HRESULT __stdcall Handle(
			[out, retval] OLE_HANDLE* phandle);"

	<virtual stdcall: hresult 4 handle*>
	^self invalidCall: _failureCode!

get_Height: pheight
	"Private - Get the value of the 'Height' property of the receiver.

		HRESULT __stdcall Height(
			[out, retval]OLE_YSIZE_HIMETRIC* pheight);"

	<virtual stdcall: hresult 8 int32*>
	^self invalidCall: _failureCode!

get_hPal: phpal
	"Private - Get the value of the 'hPal' property of the receiver.

		HRESULT __stdcall hPal(
			[out, retval] OLE_HANDLE* phpal);	"

	<virtual stdcall: int32 5 handle*>
	^self invalidCall: _failureCode!

get_KeepOriginalFormat: pfkeep
	"Private - Get the value of the 'KeepOriginalFormat' property of the receiver.

		HRESULT __stdcall KeepOriginalFormat(
			[out, retval] BOOL* pfkeep);
	"

	<virtual stdcall: hresult 13 bool*>
	^self invalidCall: _failureCode!

get_Type: ptype
	"Private - Get the value of the 'Type' property of the receiver.

		HRESULT __stdcall Type(
			[out, retval]short* ptype);"

	<virtual stdcall: hresult 6 int16*>
	^self invalidCall: _failureCode!

get_Width: pwidth
	"Private - Get the value of the 'Width' property of the receiver.

		HRESULT __stdcall Width(
			[out, retval]OLE_XSIZE_HIMETRIC* pwidth);"

	<virtual stdcall: hresult 7 int32*>
	^self invalidCall: _failureCode!

handle
	"Answer the GDI handle of the picture."

	| answer |
	answer := Handle new.
	self get_Handle: answer.
	^answer
!

height
	"Answer the <sdword> value of the 'Height' property of the receiver."

	| answer |
	answer := Int32 new.
	self get_Height: answer.
	^answer asObject!

hPal
	"Answer the handle of the picture's palette. If there is no palette then the answer will be null.
	Note that ownership of the palette varies, see the OLE documentation for further information."

	| answer |
	answer := Handle new.
	self get_hPal: answer.
	^answer
!

hPal: phpal
	"Set the 'hPal' property of the receiver to the <sdword> value of the argument."

	self put_hPal: phpal!

keepOriginalFormat
	"Answer the <bool> value of the 'KeepOriginalFormat' property of the receiver."

	| answer |
	answer := Int32 new.
	self get_KeepOriginalFormat: answer.
	^answer asInteger asBoolean
!

keepOriginalFormat: pfkeep
	"Set the 'KeepOriginalFormat' property of the receiver to the <varbool> value of the argument."

	self put_KeepOriginalFormat: pfkeep!

pictureChanged
	"Invoke the PictureChanged() method of the COM object."

	^self PictureChanged!

PictureChanged
	"Private - Invoke the PictureChanged() method of the COM object.

		HRESULT __stdcall PictureChanged();"

	<virtual stdcall: hresult 15>
	^self invalidCall: _failureCode!

put_hPal: phpal
	"Private - Set the value of the 'hPal' property of the object wrapped by the 
	 receiver to the <ExternalHandle> argument, phpal.

		HRESULT __stdcall hPal(
			[in] OLE_HANDLE phpal);
	"

	<virtual stdcall: hresult 10 handle>
	^self invalidCall: _failureCode!

put_KeepOriginalFormat: pfkeep
	"Private - Set the value of the 'KeepOriginalFormat' property of the object wrapped by the 
	 receiver to the <varbool> argument, pfkeep.

		HRESULT __stdcall KeepOriginalFormat(
			[in]VARIANT_BOOL pfkeep);"

	<virtual stdcall: hresult 14 varbool>
	^self invalidCall: _failureCode!

render: canvas x: x y: y cx: cx cy: cy xSrc: xSrc ySrc: ySrc cxSrc: cxSrc cySrc: cySrc prcWBounds: prcWBounds 
	"Invoke the Render() method of the COM Object."

	self
		Render: canvas asParameter
		x: x
		y: y
		cx: cx
		cy: cy
		xSrc: xSrc
		ySrc: ySrc
		cxSrc: cxSrc
		cySrc: cySrc
		prcWBounds: prcWBounds asParameter
!

Render: hdc x: x y: y cx: cx cy: cy xSrc: xSrc ySrc: ySrc cxSrc: cxSrc cySrc: cySrc prcWBounds: prcWBounds
	"Private - Invoke the Render() method of the COM object wrapped by the receiver.

		HRESULT __stdcall Render(
			[in] HDC hdc,
			[in] long x,
			[in] long y,
			[in] long cx,
			[in] long cy,
			[in] OLE_XPOS_HIMETRIC xSrc,
			[in] OLE_YPOS_HIMETRIC ySrc,
			[in] OLE_XSIZE_HIMETRIC cxSrc,
			[in] OLE_YSIZE_HIMETRIC cySrc,
			[in] RECTL* prcWBounds);
	"

	<virtual stdcall: hresult 9 handle int32 int32 int32 int32 int32 int32 int32 int32 RECTL*>
	^self invalidCall: _failureCode!

saveAsFile: pstm fSaveMemCopy: fSaveMemCopy
	"Answer the <Int32> result of invoking the SaveAsFile() method of the COM object."

	| answer |
	answer := Int32 new.
	self
		SaveAsFile: pstm
		fSaveMemCopy: fSaveMemCopy
		pcbSize: answer.
	^answer asObject!

SaveAsFile: pstm fSaveMemCopy: fSaveMemCopy pcbSize: pcbSize
	"Private - Invoke the SaveAsFile() method of the COM object wrapped by the receiver.

		HRESULT __stdcall SaveAsFile(
			[in] IStream* pstm,
			[in] BOOL fSaveMemCopy,
			[out] long* pcbSize);
	"

	"Declare stream parameter as IUnknown* to avoid creating dependency on structured storage package"

	<virtual stdcall: hresult 16 IUnknown* bool int32*>
	^self invalidCall: _failureCode!

selectPicture: hdcIn
	"Invoke the SelectPicture() method of the COM object."

	| outputs |
	outputs := {Int32 new. Int32 new}.
	self
		SelectPicture: hdcIn
		phdcOut: (outputs basicAt: 1)
		phbmpOut: (outputs basicAt: 2).
	^outputs collect: [:each | each asObject]!

SelectPicture: hdcIn phdcOut: phdcOut phbmpOut: phbmpOut
	"Private - Invoke the SelectPicture() method of the COM object.

		HRESULT __stdcall SelectPicture(
			[in]int hdcIn,
			[out]int* phdcOut,
			[out]OLE_HANDLE* phbmpOut);"

	<virtual stdcall: hresult 12 int32 int32* int32*>
	^self invalidCall: _failureCode!

setHdc: aCanvas 
	"Invoke the SetHdc() method of the COM object."

	^self SetHdc: aCanvas asParameter!

SetHdc: hdc
	"Private - Invoke the SetHdc() method of the COM object.

		HRESULT __stdcall SetHdc(
			[in] OLE_HANDLE hdc);"

	<virtual stdcall: hresult 18 handle>
	^self invalidCall: _failureCode!

type
	"Answer the <sword> value of the 'Type' property of the receiver."

	| answer |
	answer := Int16 new.
	self get_Type: answer.
	^answer asObject!

width
	"Answer the <sdword> value of the 'Width' property of the receiver."

	| answer |
	answer := Int32 new.
	self get_Width: answer.
	^answer asObject! !
!OS.COM.IPicture categoriesForMethods!
attributes!**auto generated**!properties!public! !
curDC!properties!public! !
extent!accessing!public! !
get_Attributes:!**auto generated**!COM Interfaces-IPicture!private! !
get_CurDC:!COM Interfaces-IPicture!private! !
get_Handle:!COM Interfaces-IPicture!private! !
get_Height:!**auto generated**!COM Interfaces-IPicture!private! !
get_hPal:!COM Interfaces-IPicture!private! !
get_KeepOriginalFormat:!COM Interfaces-IPicture!private! !
get_Type:!**auto generated**!COM Interfaces-IPicture!private! !
get_Width:!**auto generated**!COM Interfaces-IPicture!private! !
handle!properties!public! !
height!**auto generated**!properties!public! !
hPal!properties!public! !
hPal:!**auto generated**!properties!public! !
keepOriginalFormat!properties!public! !
keepOriginalFormat:!**auto generated**!properties!public! !
pictureChanged!**auto generated**!methods!public! !
PictureChanged!**auto generated**!COM Interfaces-IPicture!private! !
put_hPal:!COM Interfaces-IPicture!private! !
put_KeepOriginalFormat:!**auto generated**!COM Interfaces-IPicture!private! !
render:x:y:cx:cy:xSrc:ySrc:cxSrc:cySrc:prcWBounds:!methods!public! !
Render:x:y:cx:cy:xSrc:ySrc:cxSrc:cySrc:prcWBounds:!COM Interfaces-IPicture!private! !
saveAsFile:fSaveMemCopy:!**auto generated**!methods!public! !
SaveAsFile:fSaveMemCopy:pcbSize:!COM Interfaces-IPicture!private! !
selectPicture:!**auto generated**!methods!public! !
SelectPicture:phdcOut:phbmpOut:!**auto generated**!COM Interfaces-IPicture!private! !
setHdc:!methods!public! !
SetHdc:!COM Interfaces-IPicture!private! !
type!**auto generated**!properties!public! !
width!**auto generated**!properties!public! !
!

!OS.COM.IPicture class methodsFor!

clsid
	"Private - Answer the CLSID of the coclass (StdPicture) which supports this interface."

	^CLSID fromString: '{0BE35204-8F91-11CE-9DE3-00AA004BB851}'!

createPicture: handle type: picType owns: isOwner
	"Private - Create a new picture according to parameters."

	| answer desc |
	desc := PICTDESC new.
	desc handle: handle asParameter.
	desc picType: picType.
	answer := self newPointer.
	OleAut32
		oleCreatePictureIndirect: desc
		riid: self iid
		fOwn: isOwner
		ppvObj: answer.
	^answer!

defineFunctions
	"Declare the virtual function table for the COM interface 'stdole.IPicture'
		IPicture defineTemplate
	"

	self
		defineFunction: #get_Handle:
			argumentTypes: 'handle*';
		defineFunction: #get_hPal:
			returnType: 'sdword'
			argumentTypes: 'handle*';
		defineFunction: #get_Type:
			argumentTypes: 'sword*';
		defineFunction: #get_Width:
			argumentTypes: 'sdword*';
		defineFunction: #get_Height:
			argumentTypes: 'sdword*';
		defineFunction: #Render:x:y:cx:cy:xSrc:ySrc:cxSrc:cySrc:prcWBounds:
			argumentTypes: 'handle sdword sdword sdword sdword sdword sdword sdword sdword RECTL*';
		defineFunction: #put_hPal:
			argumentTypes: 'handle';
		defineFunction: #get_CurDC:
			argumentTypes: 'handle*';
		defineFunction: #SelectPicture:phdcOut:phbmpOut:
			argumentTypes: 'handle handle* handle*';
		defineFunction: #get_KeepOriginalFormat:
			argumentTypes: 'bool*';
		defineFunction: #put_KeepOriginalFormat:
			argumentTypes: 'bool';
		defineFunction: #PictureChanged;
		defineFunction: #SaveAsFile:fSaveMemCopy:pcbSize:
			argumentTypes: 'void* bool sdword*';
		defineFunction: #get_Attributes:
			argumentTypes: 'sdword*';
		defineFunction: #SetHdc:
			argumentTypes: 'handle'
!

fromBitmap: aBitmap
	"Answer a new instance of the receiver on a StdPicture object wrapping the <Bitmap> (or handle),
	anIcon. The bitmap will NOT be destroyed when the picture is destroyed."

	^self fromImage: aBitmap type: PICTYPE_BITMAP!

fromFile: path
	"Answer an instance loaded from the file whose path is specified by the <readableString>
	path (i.e. the argument is not a File object, but a path, which makes the selector of this
	method a bit of a misnomer, but there is precedent for this usage elsewhere)."

	| answer |
	answer := self newPointer.
	OleAut32
		oleLoadPicturePath: path
		punkCaller: nil
		dwReserved: 0
		clrReserved: 0
		riid: self iid
		ppvRet: answer.
	^answer!

fromIcon: anIcon
	"Answer a new instance of the receiver on a StdPicture object wrapping the <Icon> (or handle),
	anIcon. The icon will NOT be destroyed when the picture is destroyed."

	^self fromImage: anIcon type: PICTYPE_ICON!

fromImage: anImage type: picType
	"Private - Answer a new instance of the receiver on a StdPicture object 
	wrapping the <Image> (or handle), anImage. The image will not be destroyed 
	when the picture is destroyed."

	^self createPicture: anImage asParameter type: picType owns: false!

fromOwnedBitmap: aBitmap
	"Answer a new instance of the receiver on a StdPicture object wrapping the <Bitmap> (or handle),
	anIcon. The bitmap will be destroyed when the picture is destroyed."

	^self fromOwnedImage: aBitmap type: PICTYPE_BITMAP!

fromOwnedIcon: anIcon
	"Answer a new instance of the receiver on a StdPicture object wrapping the <Icon> (or handle),
	anIcon. The icon will be destroyed when the picture is destroyed."

	^self fromOwnedImage: anIcon type: PICTYPE_ICON!

fromOwnedImage: anImage type: picType
	"Private - Answer a new instance of the receiver on a StdPicture object 
	wrapping the <Image> (or handle), anImage. The image will be destroyed 
	when the picture is destroyed."

	^self createPicture: anImage detach type: picType owns: true!

readFromIStream: anIStream
	"Answer a new instance of the receiver on an OLE Picture object instantiated from the data
	in the <IStream>, anIStream."

	| answer |
	answer := self newPointer.
	OleAut32
		oleLoadPicture: anIStream
		lSize: 0
		fRunmode: false
		riid: self iid
		ppvObj: answer.
	^answer! !
!OS.COM.IPicture class categoriesForMethods!
clsid!constants!private! !
createPicture:type:owns:!instance creation!private! !
defineFunctions!initializing!public! !
fromBitmap:!instance creation!public! !
fromFile:!instance creation!public! !
fromIcon:!instance creation!public! !
fromImage:type:!instance creation!private! !
fromOwnedBitmap:!instance creation!public! !
fromOwnedIcon:!instance creation!public! !
fromOwnedImage:type:!instance creation!private! !
readFromIStream:!instance creation!public! !
!

