"Filed out from Dolphin Smalltalk 7"!

ClassBrowserPlugin subclass: #AstPlugin
	instanceVariableNames: 'astPresenter sourcePresenter'
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''!
AstPlugin guid: (GUID fromString: '{4aba7565-bc07-4387-b7e4-16e2f57f1801}')!
AstPlugin comment: 'AstPlugin is a <classBrowserPlugin> that displays the syntax tree for the currently selected method alongside the source.
	
Selecting a node will select the corresponding range of source. The Debug and Optimized checkboxes can be toggled to see the effect on the generated bytecodes, although note that Debug methods are never optimized.

Since this facility is probably not of interest to most developers it is not installed as one of the default plugins. If you wish to add this plugin to all browsers please evaluate:

	ClassBrowserAbstract allSubclasses do: [:each | each plugins add: self]

Alternatively Tools/Options/Inspect Options, then double click plugins, press the * button, and choose AstPlugin from the list, Ok out. The plugin will appear in any subsequently opened browser.'!
!AstPlugin categoriesForClass!MVP-Presenters! !
!AstPlugin methodsFor!

clear
	sourcePresenter text: ''.
	astPresenter model clear!

createComponents
	"Create the presenters contained by the receiver"

	super createComponents.
	astPresenter := self add: TreePresenter new name: 'syntaxTree'.
	sourcePresenter := self add: Smalltalk developmentSystem methodWorkspaceClass new name: 'source'.
	sourcePresenter isAutoParseEnabled: false.!

createSchematicWiring
	"Create the trigger wiring for the receiver"

	super createSchematicWiring.
	astPresenter
		when: #selectionChanged
		send: #onNodeSelected
		to: self.
	(self model)
		when: #classSelected
			send: #onBrowserClassSelected
			to: self;
		when: #methodSelected
			send: #onBrowserMethodSelected
			to: self!

displayMethod
	| treeModel method |
	method := self selectedMethod.
	method isNil
		ifTrue: 
			[self clear.
			^self].
	sourcePresenter text: method getSource.
	treeModel := VirtualTreeModel withRoots: (OrderedCollection with: self browser parseTree).
	astPresenter model: treeModel!

displayOn: aWriteStream 
	^aWriteStream nextPutAll: 'Syntax Tree'!

onBrowserClassSelected
	self isCurrentCard ifTrue: [self browser ensureDefinitionVisible]!

onBrowserMethodSelected
	"Event handler for a method being selected within the receiver's associated browser. "

	self isCurrentCard ifTrue: [self displayMethod]!

onNodeSelected
	sourcePresenter
		selectionRange: (astPresenter selection ifNil: [1 to: 0] ifNotNil: [:node | node sourceInterval])!

onShownInBrowser
	"Event handler indicating that the receiver has been displayed within it's browser. "

	super onShownInBrowser.
	"For efficiency we defer the creation of the diagram until the receiver becomes the current card"
	self displayMethod!

selectedMethod
	^self browser selectedMethod! !
!AstPlugin categoriesFor: #clear!private! !
!AstPlugin categoriesFor: #createComponents!initializing!public! !
!AstPlugin categoriesFor: #createSchematicWiring!initializing!public! !
!AstPlugin categoriesFor: #displayMethod!operations!private! !
!AstPlugin categoriesFor: #displayOn:!public! !
!AstPlugin categoriesFor: #onBrowserClassSelected!event handling!private! !
!AstPlugin categoriesFor: #onBrowserMethodSelected!event handling!private! !
!AstPlugin categoriesFor: #onNodeSelected!event handling!private! !
!AstPlugin categoriesFor: #onShownInBrowser!event handling!public! !
!AstPlugin categoriesFor: #selectedMethod!accessing!private! !

!AstPlugin class methodsFor!

resource_Default_view
	"Answer the literal data from which the 'Default view' resource can be reconstituted.
	DO NOT EDIT OR RECATEGORIZE THIS METHOD.

	If you wish to modify this resource evaluate:
	ViewComposer openOn: (ResourceIdentifier class: self selector: #resource_Default_view)
	"

	^#(#'!!STL' 3 788558 10 ##(Smalltalk.STBViewProxy) 8 ##(Smalltalk.ContainerView) 98 15 0 0 98 2 8 1409286144 131073 416 0 0 0 5 0 0 0 416 1180166 ##(Smalltalk.ProportionalLayout) 234 240 98 0 16 234 256 98 4 410 8 ##(Smalltalk.ScintillaView) 98 50 0 416 98 2 8 1445007428 1025 592 721990 2 ##(Smalltalk.ValueHolder) 0 32 1310726 ##(Smalltalk.EqualitySearchPolicy) 0 524550 ##(Smalltalk.ColorRef) 8 4278190080 0 5 0 0 0 592 0 8 4294905059 852486 ##(Smalltalk.NullConverter) 0 0 9 0 234 256 98 4 8 #normal 1182790 1 ##(Smalltalk.ScintillaTextStyle) 1 0 0 1 0 0 0 0 864 0 0 0 8 #callTip 882 77 786694 ##(Smalltalk.IndexedColor) 33554457 946 33554471 1 0 0 0 0 912 0 0 0 98 40 896 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1377542 ##(Smalltalk.SmalltalkMethodStyler) 1 0 0 32 202 208 544 234 256 98 2 8 #default 1641542 1 ##(Smalltalk.ScintillaMarkerDefinition) 1 0 0 0 592 8 #circle 0 0 0 0 0 0 202 208 544 0 63 9215 0 0 0 0 946 33554447 0 0 65 0 0 234 256 98 6 8 #specialCharacter 8 '()[]<>' 8 #literalBytes 8 '[]' 8 #literalArray 8 '()' 8 '' 3 234 256 98 2 8 #container 832 0 0 0 0 1 0 234 256 98 6 1 1510470 2 ##(Smalltalk.ScintillaIndicatorStyle) 1 592 65025 3 32 1 0 0 0 0 0 0 3 1410 3 592 33423361 5 32 3 0 0 0 0 0 0 5 1410 5 592 511 1 32 5 0 0 0 0 0 0 0 0 234 256 98 6 8 #Notification 882 1029 0 196934 1 ##(Smalltalk.RGB) 31185883 1 0 0 0 0 1504 0 0 0 8 #Error 882 1031 1538 335 1538 31317503 1 0 0 0 0 1568 0 0 0 8 #Warning 882 1027 1538 60239 1538 31326207 1 0 0 0 0 1632 0 0 0 0 983302 ##(Smalltalk.MessageSequence) 202 208 98 10 721670 ##(Smalltalk.MessageSend) 8 #createAt:extent: 98 2 328198 ##(Smalltalk.Point) 1 255 1826 701 247 592 1762 8 #selectionRange: 98 1 525062 ##(Smalltalk.Interval) 3 1 3 592 1762 8 #isTextModified: 98 1 32 592 1762 8 #modificationEventMask: 98 1 9215 592 1762 8 #secondaryCaretForecolor: 98 1 1538 16711423 592 1762 8 #caretPeriod: 98 1 1061 592 1762 8 #margins: 98 1 98 3 984902 1 ##(Smalltalk.ScintillaMargin) 1 592 1 3 32 1 15 2226 3 592 33 1 16 67108863 15 2226 5 592 1 1 16 -67108863 15 592 1762 8 #tabIndents: 98 1 16 592 1762 8 #tabWidth: 98 1 9 592 1762 8 #areAdditionalCaretsVisible: 98 1 16 592 983302 ##(Smalltalk.WINDOWPLACEMENT) 8 #[44 0 0 0 0 0 0 0 1 0 0 0 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 0 0 0 0 127 0 0 0 94 1 0 0 250 0 0 0] 98 0 1826 193 193 0 29 8 'source' 410 8 ##(Smalltalk.MoenTreeView) 98 30 0 416 98 2 8 1409286144 1 2528 590918 3 ##(Smalltalk.TreeModel) 0 1310726 ##(Smalltalk.IdentitySearchPolicy) 525062 ##(Smalltalk.TreeNode) 0 0 0 234 256 544 738 8 4278190080 0 517 0 0 0 2528 788998 ##(Smalltalk.MoenTreeNode) 0 721926 ##(Smalltalk.MoenContour) 0 0 0 0 1826 1 1 2816 0 0 0 0 0 7 459270 ##(Smalltalk.Message) 8 #displayString 98 0 2544 268435457 1826 5 3 1049926 1 ##(Smalltalk.IconImageManager) 1826 1 1 41 0 197382 ##(Smalltalk.Pen) 0 16 393478 ##(Smalltalk.LOGPEN) 8 #[0 0 0 0 1 0 0 0 0 0 0 0 192 192 192 0] 1826 33 33 1826 19999 19999 114721 2944 1826 35 1 0 0 0 1698 202 208 98 1 1762 1792 98 2 1826 1 1 1826 701 245 2528 2434 8 #[44 0 0 0 0 0 0 0 1 0 0 0 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 0 0 0 0 0 0 0 0 94 1 0 0 122 0 0 0] 98 0 2496 0 27 8 'syntaxTree' 0 1698 202 208 98 1 1762 1792 98 2 1826 3839 21 1826 701 501 416 2434 8 #[44 0 0 0 0 0 0 0 1 0 0 0 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 127 7 0 0 10 0 0 0 221 8 0 0 4 1 0 0] 98 3 2528 410 8 ##(Smalltalk.Splitter) 98 12 0 416 98 2 8 1140850688 1 3424 0 738 8 4278190080 0 517 0 0 0 3424 1698 202 208 98 1 1762 1792 98 2 1826 1 245 1826 701 11 3424 2434 8 #[44 0 0 0 0 0 0 0 1 0 0 0 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 0 0 0 0 122 0 0 0 94 1 0 0 127 0 0 0] 98 0 2496 0 27 592 2496 0 27 )! !
!AstPlugin class categoriesFor: #resource_Default_view!public!resources-views! !

