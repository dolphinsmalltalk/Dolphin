"Filed out from Dolphin Smalltalk"!

Tools.ClassBrowserPlugin
	subclass: #'Tools.AstPlugin'
	instanceVariableNames: 'astPresenter sourcePresenter'
	classVariableNames: ''
	imports: #()
	classInstanceVariableNames: ''
	classConstants: {}!
Tools.AstPlugin guid: (Core.GUID fromString: '{4aba7565-bc07-4387-b7e4-16e2f57f1801}')!
Tools.AstPlugin comment: '`AstPlugin` is a `<classBrowserPlugin>` that displays the syntax tree for the currently selected method alongside the source.
	
Selecting a node in the AST will select the corresponding range of source.

Since this facility is probably not of interest to most developers it is not installed as one of the default plugins. If you wish to add this plugin to all browsers please evaluate:
```
	ClassBrowserAbstract allSubclasses do: [:each | each plugins add: self]
```
Alternatively Tools/Options/Inspect Options, then double click plugins, press the * button, and choose AstPlugin from the list, Ok out. The plugin will appear in any subsequently opened browser.'!
!Tools.AstPlugin categoriesForClass!MVP-Presenters! !
!Tools.AstPlugin methodsFor!

clear
	sourcePresenter text: ''.
	astPresenter model clear!

createComponents
	"Create the presenters contained by the receiver"

	super createComponents.
	astPresenter := self add: TreePresenter new name: 'syntaxTree'.
	sourcePresenter := self add: SmalltalkSystem current methodWorkspaceClass new name: 'source'.
	sourcePresenter isAutoParseEnabled: false!

createSchematicWiring
	"Create the trigger wiring for the receiver"

	super createSchematicWiring.
	astPresenter
		when: #selectionChanged
		send: #onNodeSelected
		to: self.
	(self model)
		when: #classSelected
			send: #onBrowserClassSelected
			to: self;
		when: #methodSelected
			send: #onBrowserMethodSelected
			to: self!

displayMethod
	| treeModel method |
	method := self selectedMethod.
	method isNil
		ifTrue: 
			[self clear.
			^self].
	sourcePresenter text: method getSource.
	treeModel := VirtualTreeModel withRoots: (OrderedCollection with: self browser parseTree).
	astPresenter model: treeModel!

displayOn: aPuttableStream
	"Append to the <puttableStream> first argument a String whose characters are a representation of the receiver that an end-user might want to see."

	^aPuttableStream nextPutAll: 'Syntax Tree'!

onBrowserClassSelected
	self isCurrentCard ifTrue: [self browser ensureDefinitionVisible]!

onBrowserMethodSelected
	"Event handler for a method being selected within the receiver's associated browser. "

	self isCurrentCard ifTrue: [self displayMethod]!

onNodeSelected
	sourcePresenter
		selectionRange: (astPresenter selection ifNil: [1 to: 0] ifNotNil: [:node | node sourceInterval])!

onShownInBrowser
	"Event handler indicating that the receiver has been displayed within it's browser. "

	super onShownInBrowser.
	"For efficiency we defer the creation of the diagram until the receiver becomes the current card"
	self displayMethod!

selectedMethod
	^self browser selectedMethod! !
!Tools.AstPlugin categoriesForMethods!
clear!private! !
createComponents!initializing!public! !
createSchematicWiring!initializing!public! !
displayMethod!operations!private! !
displayOn:!public! !
onBrowserClassSelected!event handling!private! !
onBrowserMethodSelected!event handling!private! !
onNodeSelected!event handling!private! !
onShownInBrowser!event handling!public! !
selectedMethod!accessing!private! !
!

!Tools.AstPlugin class methodsFor!

resource_Default_view
	"Answer the literal data from which the 'Default view' resource can be reconstituted.
	DO NOT EDIT OR RECATEGORIZE THIS METHOD.

	If you wish to modify this resource evaluate:
	Tools.ViewComposer openOn: (UI.ResourceIdentifier class: self selector: #resource_Default_view)
	"

	^#(#'!!STL' 5 985166 10 #{UI.STBViewProxy} #{UI.ContainerView} 34 15 nil nil 34 2 8 1409286144 131073 416 nil nil nil 5 nil nil nil 416 1376774 #{UI.ProportionalLayout} 170 176 8 #() true 170 192 34 4 410 #{UI.MoenTreeView} 34 30 nil 416 34 2 8 1409286144 262145 576 787526 3 #{UI.TreeModel} nil 1769478 #{Kernel.IdentitySearchPolicy} 721670 #{UI.TreeNode} nil nil nil 170 192 528 917510 #{Graphics.Color} #default nil 517 nil nil nil 576 985606 #{UI.MoenTreeNode} nil 918534 #{UI.MoenContour} nil nil nil nil 918022 #{Graphics.Point} 1 1 864 nil nil nil nil nil 7 786950 #{Core.Message} #displayString 8 #() #{UI.MoenTreeView} 268435457 850 5 3 1639750 1 #{Graphics.IconImageManager} 850 1 1 41 nil 787206 #{Graphics.Pen} nil true 590086 #{OS.LOGPEN} 8 #[0 0 0 0 1 0 0 0 0 0 0 0 192 192 192 0] 850 33 33 850 19999 19999 114721 976 850 35 1 nil nil nil 1310982 #{Core.MessageSequence} 34 1 1049350 #{Core.MessageSend} #createAt:extent: 34 2 850 1 1 850 701 245 576 1179910 #{OS.WINDOWPLACEMENT} 8 #[44 0 0 0 0 0 0 0 1 0 0 0 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 0 0 0 0 0 0 0 0 94 1 0 0 122 0 0 0] 8 #() 850 193 193 nil 27 8 'syntaxTree' 410 #{UI.Scintilla.ScintillaView} 34 52 nil 416 34 2 8 1445007428 262145 1344 918598 2 #{UI.ValueHolder} nil false 1769478 #{Kernel.EqualitySearchPolicy} nil 1245702 #{Graphics.ThemeColor} #smalltalkWorkspace nil 5 nil nil nil 1344 nil 8 1395533126 1049094 #{UI.NullConverter} nil nil 9 nil 170 192 34 4 #callTip 1444934 1 #{UI.Scintilla.TextStyle} 77 754 #gray 754 #white 1 nil nil nil nil #callTip nil nil nil #normal 1586 1 nil nil 1 nil nil nil nil #normal nil nil nil nil 1770758 #{Tools.SmalltalkMethodStyler} 1 nil nil false 138 144 528 170 192 34 2 #default 1903686 2 #{UI.Scintilla.MarkerDefinition} 1 nil nil nil 1344 #circle nil nil nil nil nil nil 138 #{Core.IdentitySet} 528 nil 170 176 528 9215 nil nil 170 176 34 2 81 754 #windowText nil nil 2162950 #{UI.Scintilla.NullScintillaLibrary} nil 65 nil nil 170 192 34 6 #literalArray 8 '()' #specialCharacter 8 '()[]<>' #literalBytes 8 '[]' 8 '' 3 170 192 34 2 #container 1552 nil nil nil nil 16 nil 170 192 34 6 1 1772614 4 #{UI.Scintilla.IndicatorStyle} 1 1344 754 #commonGreen 3 3 1 nil nil nil nil nil nil 3 2050 3 1344 754 #blue 5 3 3 nil nil nil nil nil nil 5 2050 5 1344 754 #red 1 3 5 nil nil nil nil nil nil nil nil 170 192 34 6 #Notification 1586 1029 nil 754 #gainsboro 1 nil nil nil nil #Notification nil nil nil #Error 1586 1031 754 #firebrick 754 #floralWhite 1 nil nil nil nil #Error nil nil nil #Warning 1586 1027 754 #darkGoldenrod 754 #ivory 1 nil nil nil nil #Warning nil nil nil nil nil nil 1122 34 7 1170 #createAt:extent: 34 2 850 1 255 850 701 247 1344 1170 #margins: 34 1 34 3 1247302 3 #{UI.Scintilla.Margin} 1 1344 1 3 nil nil nil nil 2466 3 1344 33 nil 3 67108863 nil nil 2466 5 1344 1 nil 3 -67108863 nil nil 1344 1170 #tabWidth: 8 #(4) 1344 1170 #maxCompletionListHeight: 8 #(9) 1344 1170 #sciSetTechnology: 8 #(1) 1344 1170 #sciSetFontQuality: 8 #(3) 1344 1170 #sciSetSelectionLayer: 8 #(1) 1344 1250 8 #[44 0 0 0 0 0 0 0 1 0 0 0 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 0 0 0 0 127 0 0 0 94 1 0 0 250 0 0 0] 8 #() 1312 nil 35 8 'source' nil 1122 34 1 1170 #createAt:extent: 34 2 850 12287 21 850 701 501 416 1250 8 #[44 0 0 0 0 0 0 0 1 0 0 0 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 23 0 0 10 0 0 0 93 25 0 0 4 1 0 0] 34 3 576 410 #{UI.Splitter} 34 12 nil 416 34 2 8 1140850688 1 2896 nil nil nil 517 nil nil nil 1707078 1 #{UI.DraggableViewInteractor} 2896 nil 1 #left nil nil nil 850 1 1 850 9 9 nil 2992 nil 1122 34 1 1170 #createAt:extent: 34 2 850 1 245 850 701 11 2896 1250 8 #[44 0 0 0 0 0 0 0 1 0 0 0 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 0 0 0 0 122 0 0 0 94 1 0 0 127 0 0 0] 8 #() 1312 nil 27 1344 1312 nil 27)! !
!Tools.AstPlugin class categoriesForMethods!
resource_Default_view!public!resources-views! !
!

